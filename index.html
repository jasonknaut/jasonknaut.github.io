<!doctype html>
<html lang="en">
<head>
  <title>Visualizing 16M Citibike Rides</title>
  <link href="css/main.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Libre+Baskerville|Roboto:100,300,400,700" rel="stylesheet">
  <script type="text/javascript" src="js/slideviz.js"></script>
  <script type="text/javascript" src="https://d3js.org/d3.v4.js"></script>
  <meta charset='utf-8'>
  <meta property="og:title" content="Visualizing 16 Million Citibike Rides" />
  <meta property="og:description" content="In 2017, Citibike—New York City's bikeshare network—enabled residents, commuters, and visitors to take more than 16 million rides throughout the city. The following visualizations explore a year of rides across the city, including utilization across individual bikeshare stations, seasonality, and intra-day demand patterns, to bring the network to life." />
  <meta property="og:url" content="https://jasonknaut.github.io/" />
  <meta property="og:image" content="https://jasonknaut.github.io/images/og.png" />
</head>
<body>
  <div id="content">

    <!-- Slide: About this Visualiztion -->
    <div class="slide-contents offscreen left" id="slide-about" data-next="slide-intro">
      <h1 class="center">About This Visualization.</h1>
      <div id="about-container">
        <h3>Narrative Style: Interactive Slideshow</h3>
        <p>
        This visualization of monthly Citibike ride data employs the interactive slideshow narrative techqnique.
        My goal for the visualization was to narrate key themes I discovered about where, when, and why ride demand
        changed over the course of twelve months. This narrative is inherently linear making both the interactive slideshow
        and martini glass styles valid alternatives. However, it became apparent that providing the user an ability to
        explore the details of each scene before proceeding to the next scene would promote more interaction with the
        underlying changes as the year progressed. The martini glass style would have forced the user to go through my monthly commentary
        for all twelve months before having the opportunity to go back an explore each month in more detail.
        </p>

        <h3>Frames & Scenes</h3>
        <p>
        The interactive slideshow is composed of two key frames, each of which has twelve scenes capturing ridership demand
        for a particular month.
        </p>
          <h4>Frames</h4>
          <p>
          The narrative covers two insightful views of ride trends over time: 1) by geographic location across the Citibike system and
          2) by time of day/day of week. Combining both of these insights into one frame would make it more challenging to walk the
          user through the key observations. Therefore, the individual frames are represented by individual "slides" in the visualization.
          I used a slide/fade transition between these two frames to clearly indicate to the user that, while related, these two analyses are
          trying to offer different perspectives on overall Citibike ridership.
          </p>
          <p>
          The first frame visualizes rides by individual bike station across New York City. I selected three key visual elements to orient the user
          and provide engagement around the underlying detail. At the top of the frame, I provide a bar chart showing the system-wide monthly ride volume
          for 2017. This element provides the context for the 12 scenes within this overall frame and also offers a method to quickly navigate between
          scenes (discussed more in the triggers section). The next key visual element is a map of New York City, overlayed with points representing
          ride demand at individual bikeshare stations. Finally, the frame includes three summary statistics for the specific scene that summarize the key
          aspects of the map.
          </p>
          <p>
          The second frame offers a different view of the Citibike system over the course of 2017. This frame is composed of a heatmap (the primary visual element) and
          two historgrams capturing the ride demand by hour and day of the week.
          </p>
          <h4>Scenes</h4>
          <p>
          The slideshow consists of 24 scenes: 12 monthly scenes for each of the distinct frames. The frame layout ensures visual consistency across each of the
          monthly scenes and serves as the grounding orientation. The user can step through the individual scenes in order and the frames update
          using animation to indicate how data changes from one scene to the next. For example, on the map visualization, the points both gradually change size and color when
          the user navigates to a new scene, giving a visual indication of the trends (e.g., is demand increasing or decreasing at each station month-on-month).
          The month header also fades completely out and in on transition to make it very clear that the scene has changed. As another example, on the hour/day visualization,
          the histograms animate height changes between scenes to demonstrate how monthly demand by hour or time of day is trending.
          </p>
          <p>
          As an interactive slideshow, an important characteristic is the ability to explore the detail within each scene before navigating to another scene. For this,
          I added tooltips over key elements. In the map visualiziation, a user can explore the volume of rides that occurred at each individual station within the
          current scene. In the hour/day visualization, the user can explore the ride demand within specific cells (i.e., hour/day of week pairs) and on the histograms
          (i.e., total monthly rides for a particular time of day or day of week).
          </p>

        <h3>Annotations</h3>
        <p>
        The visualization uses annotations on select scenes where there is a meaningful trend or point in the data that communicates what, why, or how ride demand is
        changing over time. General points that apply to the entire narrative are annotated without leader lines. Points of interest that relate to specific aspects
        of a visual element are annotated with a leader line to the relevant area of interest in the chart.
        </p>
        <p>
        Annotations are used selectively. Not every scene will have an annotation. This is to balance the need to communicate the story while also not unecessarily
        adding "ink" that makes the visualization more complex to understand or interact with.
        </p>
        <h4>Displaying & Clearing</h4>
        <p>
        Annotations are attached to individual scenes (i.e. a specific month for the current frame). Therefore, when a user navigates to a new scene, any annotations
        on the prior scene are hidden and relevant annotations (if any) on the new scene are displayed. Annotations are transitioned in and out using a fade to add
        another visual indicator of the scene change and to make clear which annotations are no longer relevant and which are relevant to the new scene.
        </p>
        <h4>Template</h4>
        <p>
        The annotations follow one standard template with a variation for 1) with leader line and 2) no leader line. The template includes: 1) a short heading (in blue) and
        2) a more detailed key takeaway (in white). When a leader line is required, it is plotted as a white dotted line from the annotation to the relevant area on the
        visualization. To ensure visual consistency, all annotations are generated from a single "Annotation Factory" method, taking an array of annotations as input, and returning
        d3 svg elements.
        </p>

        <h3>Parameters</h3>
        <p>
        The visual narrative relies on two parameters: 1) frame ("slide") number and 2) month.
        </p>
        <h4>Selected Frame ("Slide") #</h4>
        <p>
        The frame ("slide") number parameter has two important contributions for visualization state. First, the frame number is used to determine which slide should be
        presented to the user. There are four slides in the visualization: "About this Visualization", "Intro", "Rides by Station/Map Visualization", and
        "Rides by Hour & Day/Heatmap Visualization." More importantly, the frame parameter is mapped to the appropriate dataset. The "Rides by Station" and "Rides by Hour/Day"
        frames each have their own dataset that must be loaded when this frame parameter is changed.
        </p>
        <h4>Selected Month</h4>
        <p>
        The second parameter is the selected month. This parameter takes on a value between one and twelve, and controls what scene is shown within the currently selected frame.
        Changes to the selected month parameter filter the dataset for the current frame to include only data relevant to the month. The selected month parameter also drives
        which annotations are visible to the user in the current state.
        </p>
        <h3>Triggers</h3>
        <p>
        This visualization contains numerous triggers to interact with the slideshow. To help the user discover these triggers, I relied on
        <a href="https://www.nngroup.com/articles/ten-usability-heuristics/" target="_blank">Neilsen's core UX principles</a>. Most notably, I followed the principle of "consistency
        and standards." This principle suggests using visual UI elements that a user is familiar with due to widespread use. A few examples include, common previous and next buttons
        for the slides as well as the left and right "carrots" next to the month header (i.e. to go forward or back one month). In addition, I used common cursor patterns, making sure
        items with interaction turned the pointer into the "hand" cursor suggesting the item could be clicked or that some event would be triggered by interaction. And finally, to
        make the navigation between months within a given frame, I added a pulsing halo around the month forward navigation to draw the user's attention.
        </p>
        <h4>Frame/Slide Navigation Trigger</h4>
        <p>
        The user navigates between the frames/slides of the interactive slideshow using two key triggers. The first trigger includes the large previous and next slide buttons
        fixed to the left and right rails of the browser. Clicking on these buttons changes the frame parameter (discussed above), which causes a linear slide transition
        left or right, ultimately redrawing the visualization associated with the previous or next frame.
        </p>
        <p>
        The second trigger for frame/slide navigation is the slide selection bar at the bottom of the browser. This navigation becomes available once the user starts the
        interactive slideshow from the home screen. In addition to being able to jump to specific frames/slides within the slideshow, this navigation also serves as an
        indicator of the current position within the slideshow (i.e., slide 1 = Map visualization; slide 2 = Hour/day grid visualization).
        </p>
        <h4>Monthly Rides Bar Chart</h4>
        <p>
        Within the "Rides by Station" frame, the user can jump to a desired month scene by clicking the appropriate bar in the bar chart at the top of the frame. The ability
        to interact with this element is accentuated by highlighting the bars as the mouse moves over them. This click event sets the month parameter and redraws the frame.
        </p>
        <h4>New York Citiy Map Points</h4>
        <p>
        Mousing over any of the "circles" representing bikeshare stations on the map triggers a tooltip with info about the relevant station.
        </p>
        <h4>Heatmap/Grid Cells & Histogram Bars</h4>
        <p>
        Mousing over the cells of the heatmap visualization or the histogram bars triggers a tooltip with info about the selected hour/day of week.
        </p>
        <h3>Enjoy exploring the narrative!</h3>
      </div>
    </div>

    <!-- Slide: Introduction to the Visualization -->
    <div class="slide-contents" id="slide-intro" data-next="slide-viz1" data-initial data-hidenav>
      <h1 class="center">Take a Ride Through the <br/>New York City Bikeshare System.</h1>
      <div class="byline">
        <a href="https://www.linkedin.com/in/jknaut" target="_blank">
          <img src="images/me_tiny.jpg" />Jason Knaut
        </a>
      </div>
      <p class="abstract">
        In 2017, Citibike&#8212;New York City's bikeshare network&#8212;enabled residents, commuters, and
        visitors to take more than 16 million rides throughout the city. The following visualizations explore
        a year of rides across the city, including utilization across individual bikeshare stations, seasonality,
        and intra-day demand patterns, to bring the network to life.
      </p>
        <button id="about-btn" class="text-btn"><img src="images/info-round.svg" alt="About this Visulization">About this Visualization</button>
        <br />
        <button id="start-btn" class="btn-round pulse"><img src="images/right-arrow.svg" alt="Start"></button>
    </div>

    <!-- Data Viz Slide #1: Monthly Ride Data Plotted on a Geomap of the Citibike System -->
    <div class="slide-contents offscreen right" id="slide-viz1" data-next="slide-viz2" data-prev="slide-intro">
      <h1 class="center">Riders Completed <span id="map-totalrides">{insert}</span> Trips Around New York City in 2017.</h1>
      <div id="ridebarchart-container"></div>
      <div id="mapviz-container" class="clearfix">
        <div id="map-commentary" class="vizslide">
          <h4>Monthly Rides by Station</h4>
          <div class="month-selector">
            <button class="btn-round tiny disabled prev"><img src="images/back.svg" alt="Prev Month"></button>
            <h3 id="mapviz-currentmonth"></h3>
            <button class="btn-round tiny next clue"><img src="images/next.svg" alt="Next Month"></button>
          </div>
          <div class="map-stat">
            <span id="mo-stat-rides" class="stat"></span>
            <span class="stat-label">Rides</span>
          </div>
          <div class="map-stat">
            <span id="mo-stat-active" class="stat"></span>
            <span class="stat-label">Active Stations</span>
          </div>
          <div class="map-stat">
            <span id="mo-stat-avg" class="stat"></span>
            <span class="stat-label">Avg. Rides per Station</span>
          </div>
        </div>
        <div id="map-container">
        </div>
        <div id="map-legend"></div>
      </div>
    </div>

    <!-- Data Viz Slide #2: Ride Frequency by Day of Week -->
    <div class="slide-contents offscreen right" id="slide-viz2" data-next="slide-viz3" data-prev="slide-viz1">
      <h1 class="center">Bikeshare Usage Varies Depending on the Time of Day and Day of Week.</h1>
      <div id="gridviz-container" class="vizslide">
        <h4>Rides by Hour and Day of Week</h4>
        <div class="month-selector">
          <button class="btn-round tiny disabled prev"><img src="images/back.svg" alt="Prev Month"></button>
          <h3 id="gridviz-currentmonth"></h3>
          <button class="btn-round tiny next clue"><img src="images/next.svg" alt="Next Month"></button>
        </div>
        <div id="gridviz">
        </div>
        <div id="grid-legend"></div>
      </div>
    </div>

    <!-- Data Viz Slide #3: Distribution of Rides by Time of Day -->
    <div class="slide-contents offscreen right" id="slide-viz3" data-prev="slide-viz2">
      <h1 class="center">Not Done Exploring? Citibike Publishes Even More Data to Check Out.</h1>
      <div id="final-container">
<button class="datasource" onclick="window.open('https://www.citibikenyc.com/system-data', '_blank');"><div><img src="images/citibike.svg"></img><span>System Datasets</span></div></button>
        <p class="abstract">
          This project was based on bike ride data provided by Citibike. There is even more data to explore, including bike trip histories, ridership, membership, and even real-time data.
        </p>
        <p class="abstract">
          Or stick around and take another look at the interactive slideshow...
        </p>
        <button id="restart-btn" class="btn-round pulse"><img src="images/refresh.svg" alt="Start"></button>
      </div>
    </div>


    <!-- Navigation to select slides in the slideshow -->
    <div id="slide-nav" class="hidden">
        <button id="slide-btn1" class="slide-btn selected" data-linkedto="slide-intro"><img src="images/home.svg" alt="Home"></button>
        <button id="slide-btn2" class="slide-btn" data-linkedto="slide-viz1">1</button>
        <button id="slide-btn3" class="slide-btn" data-linkedto="slide-viz2">2</button>
        <button id="slide-btn4" class="slide-btn" data-linkedto="slide-viz3">3</button>
    </div>
  </div>
  <div id="left-nav" class="hidden"><div id="slide-prev-btn" class="btn-round small"><img src="images/left-arrow.svg" alt="Go Back"></div></div>
  <div id="right-nav" class="hidden"><div id="slide-next-btn" class="btn-round small"><img src="images/right-arrow.svg" alt="Go Forward"></div></div>

  <div id="tooltip">Test</div>

  <script type="text/javascript">

    /** ------------- SETUP INTERACTIVE SLIDESHOW UI ------------- **/
    slideviz.setup();

    const monthNames = ["January", "February", "March", "April", "May", "June",
      "July", "August", "September", "October", "November", "December"
    ];

    const monthNamesShort = ["Jan", "Feb", "Mar", "Apr", "May", "Jun",
      "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"
    ];

    const dayNames = {
      "1": { "short": "Sun", "full": "Sunday"},
      "2": { "short": "Mon", "full": "Monday"},
      "3": { "short": "Tue", "full": "Tuesday"},
      "4": { "short": "Wed", "full": "Wednesday"},
      "5": { "short": "Thu", "full": "Thursday"},
      "6": { "short": "Fri", "full": "Friday"},
      "7": { "short": "Sat", "full": "Saturday"}
    };

    const dayLabel = ["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];

    const hourLabel = ["12AM","1AM","2AM","3AM","4AM","5AM","6AM","7AM","8AM","9AM","10AM","11AM","12PM",
                       "1PM","2PM","3PM","4PM","5PM","6PM","7PM","8PM","9PM","10PM","11PM"];

    function formatHour(hour) {
      if (hour == 0) {
        return "12AM";
      } else if (hour == 12) {
        return "NOON";
      } else if (hour < 12) {
        return hour + "AM";
      } else {
        return hour - 12 + "PM";
      }
    }

    /** ------------- COLORS ------------- **/
    colors = {
      "white": "#ffffff",
      "navy": "#00192e",
      "dark_blue": "#002040",
      "blue": "#033c66",
      "light_blue": "#13639f",
      "yellow": "#f2b06f",
      "green": "#4ebe97",
      "cyan": "#8bcee2",
      "pink": "#f57295",
      "purple": "#b154aa",
      "dark_purple": "#7c5abf"

    }

    /** ------------- D3 SETUP ------------- **/

    d3.queue()
      .defer(d3.json, "data/nyc-neighborhoods.geojson")
      .defer(d3.csv, "data/citibike_2017_rides_by_station.csv")
      .defer(d3.csv, "data/citibike_2017_rides_by_day_and_hour.csv")
      .await(ready);

    function ready(error, map_data, rides_data, intraday_data, weather_data) {
      create_map_viz(map_data, rides_data);
      create_grid_viz(intraday_data);
    }

    d3.selectAll('.clue')
      .on('mouseover', function() {
        d3.select(this)
          .classed('clue', false);
      });

    /** ------------- RIDES BY STATION VIZ ------------- **/

    function create_map_viz(map_data, rides_data) {
      const chart_width = 800;
      const chart_height = 50;
      const axis_height = 25;
      const map_width = 500;
      const map_height = 500;
      const map_scale = 130000;
      const map_lat = -74.0112;
      const map_long = 40.7331;
      const pt_minr = 3;
      const pt_maxr = 12;
      const pt_opacity = 0.8;
      const legend_height = 35;
      const legend_width = 250;

      var selected_month = 1;      // Start the visualization at January.

      var prev_btn = d3.select("#mapviz-container").select(".prev")
      var next_btn = d3.select("#mapviz-container").select(".next")

      /** Create the bar chart with total rides by month **/
      function draw_barchart(update_points, update_anotations) {

        var x = d3.scaleBand().rangeRound([0, chart_width])
        var y = d3.scaleLinear().range([chart_height, 0]);

        // Summarize data by month
        var monthlyrides = d3.nest()
                             .key(function(d) { return +d.ride_month; })
                             .sortKeys((a, b) => d3.ascending(+a, +b))
                             .rollup(function(x) { return d3.sum(x, function(d) {return (d.ride_count)}); })
                             .entries(rides_data);

        x.domain(monthlyrides.map(function(d) { return d.key; }));
        y.domain([0, d3.max(monthlyrides, function(d) { return d.value; })]);

        var svg = d3.select('#ridebarchart-container')
                    .append('svg')
                    .attr('width', chart_width)
                    .attr('height', chart_height + axis_height);

        // Draw bars
        svg.selectAll("rect")
           .data(monthlyrides)
           .enter()
           .append("rect")
           .attr("class", function(d) { return d.key == selected_month ? "bar-selected" : "bar"; })
	         .attr("x", function(d) { return x(d.key); })
	         .attr("y", function(d) { return y(d.value); })
	         .attr("width", x.bandwidth())
	         .attr("height", function(d) { return chart_height - y(d.value); })
           .on("click", click);

        // Add month labels
        svg.selectAll(".xlabel")
           .data(monthNamesShort)
           .enter()
           .append("text")
           .classed("xlabel", true)
           .classed("selected", function(d,i) { return i+1 == selected_month; })
           .attr("x", function(d, i) { return x(i+1) + x.bandwidth() / 2; })
           .attr("y", chart_height+18)
           .text(function(d) { return d; });

        // Update chart month heading
        update(selected_month);

        function update(month_id) {

          // Redraw station points on the map
          update_points(month_id);

          // Show/hide annotations
          update_anotations(month_id);

          // Disable prev next month selectors if not relevant
          next_btn.classed("disabled", selected_month == 12);
          prev_btn.classed("disabled", selected_month == 1);

          // Select the bar for the new month
          svg.selectAll("rect")
             .data(monthlyrides)
             .attr("class", function(d) { return d.key == selected_month ? "bar-selected" : "bar"; });

          // Format the labels on the bar chart (newly selected month)
          svg.selectAll("text")
             .data(monthNamesShort)
             .transition()
             .duration(200)
             .attr("class", function(d,i) { return i+1 == month_id ? "xlabel selected" : "xlabel"; })

          // Add the selected month to the commentary
          d3.select('#mapviz-currentmonth')
            .transition().duration(150)
            .style("opacity", 0)
            .transition().duration(150)
            .style("opacity", 1)
            .text(monthNames[month_id-1] + " 2017");

          // Update the stats in the commentary
          stats = rideStats(month_id);

          var format = d3.format(",d");

          d3.select('#mo-stat-rides')
            .transition()
            .duration(200)
              .on("start", function repeat() {
                d3.active(this)
                    .tween("text", function() {
                      var that = d3.select(this),
                          i = d3.interpolateNumber(that.text().replace(/,/g, ""), stats.rides);
                      return function(t) { that.text(format(i(t))); };
                    });
              });

          d3.select('#mo-stat-active')
            .transition()
            .duration(200)
              .on("start", function repeat() {
                d3.active(this)
                    .tween("text", function() {
                      var that = d3.select(this),
                          i = d3.interpolateNumber(that.text().replace(/,/g, ""), stats.stations);
                      return function(t) { that.text(format(i(t))); };
                    });
              });

          d3.select('#mo-stat-avg')
            .transition()
            .duration(200)
              .on("start", function repeat() {
                d3.active(this)
                    .tween("text", function() {
                      var that = d3.select(this),
                          i = d3.interpolateNumber(that.text().replace(/,/g, ""), stats.rides_per_station);
                      return function(t) { that.text(format(i(t))); };
                    });
              });

        }


        /** Click event listener for bar clicks **/
        function click(d) {
          d3.select(".bar-selected").attr("class", "bar");
          d3.select(this).attr("class", "bar-selected");
          selected_month = +d.key;
          update(selected_month);
        }

        /** Set event listener for month selector clicks **/
        prev_btn.on("click", function() { onMonthClick(-1); });
        next_btn.on("click", function() { onMonthClick(+1); });

        /** Month selector callback **/
        function onMonthClick(dir) {
          new_month = selected_month + dir;
          if (new_month <= 12 & new_month >= 1) {
            selected_month = new_month;
            update(selected_month);
          }
        }

        /** Helper to get the stats for the selected month **/
        function rideStats(month) {
          var stats = d3.nest()
                        .key(function(d) { return d.ride_month; })
                        .rollup(function(v) {
                                  return {
                                    stations: v.length,
                                    rides: d3.sum(v, function(d) { return +d.ride_count; })
                                  }; })
                        .entries(
                          rides_data.filter(function(d) { return +d.ride_month == month & +d.ride_count > 0; })
                        )[0].value;
          stats.rides_per_station = Math.round(stats.rides / stats.stations)
          return stats;

        }

      }

      /** Create the map of NYC **/
      function draw_map() {
        var projection = d3.geoMercator()
                           .scale(map_scale)
                           .center([map_lat, map_long])
                           .translate([map_width / 2, map_height / 2]);

        var path = d3.geoPath().projection(projection);

        var svg = d3.select('#map-container')
                    .append('svg')
                    .attr('width', map_width)
                    .attr('height', map_height);

        var g = svg.append('g');

        var mapLayer = g.append('g').classed('map-layer', true);
        var plotLayer = g.append('g').classed('plot-layer', true);
        var tooltip = d3.select("#tooltip")

        mapLayer.selectAll('path')
                 .data(map_data.features)
                 .enter().append('path')
                 .attr('d', path)
                 .style('fill', colors.blue)
                 .style('stroke', colors.dark_blue);

        var total_rides = d3.sum(rides_data, function(d){return +d.ride_count;});
        d3.select('#map-totalrides').text(Number(total_rides).toLocaleString());

        // Add the stations to the map
        // Group data by station
        var station_data = d3.nest()
                     .key(function(d) { return d.station; }).sortKeys(d3.ascending)
                     .key(function(d) { return d.ride_month; }).sortKeys((a, b) => d3.ascending(+a, +b))
                     .entries(rides_data);

        var max_rides = d3.max(rides_data, function(d) { return +d.ride_count;} );
        var scale = d3.scaleLinear()
                      .domain([0, max_rides])
                      .range([pt_minr, pt_maxr]);

        // Create a gradient scale based on # of rides
        var color_scale = d3.scaleLinear()
                      .domain([0, 0.1 * max_rides, 0.2 * max_rides, 0.3 * max_rides, .45 * max_rides, max_rides])
                      .range([colors.light_blue, colors.cyan, colors.dark_purple, colors.purple, colors.yellow, colors.pink]);

        function station_coord(station) {
          lat = +station.values[0].values[0].lat;
          long = +station.values[0].values[0].long;
          return [long, lat];
        }

        function station_rides(station, month) {
          var rides = 0;
          for (var i=0; i < station.values.length; i++) {
            var d = station.values[i];
            if(d.key == String(month)) {
              rides = +d.values[0].ride_count;
            }
          }
          return rides;
        }

        /** Create the initial points for each station **/
        function create_points() {
          plotLayer.selectAll('circle')
                   .data(station_data)
                   .enter().append('circle')
                   .attr("cx", function (d) { return projection(station_coord(d))[0]; })
                   .attr("cy", function (d) { return projection(station_coord(d))[1]; })
                   .attr("r", function (d) { return scale(station_rides(d, selected_month)); })
                   .style("fill", function (d) { return color_scale(station_rides(d, selected_month)); })
                   .style("fill-opacity", pt_opacity)
                   .style("visibility", function (d) { return station_rides(d, selected_month) == 0 ? "hidden" : "visible"; })
                   .attr('stroke',colors.white)
                   .attr('stroke-width',0)
                   .style("cursor", "pointer")
                   .on('mouseover',function(d) {
                                                d3.select(this)
                                                  .transition()
                                                  .duration(100)
                                                  .attr('stroke-width',2);
                                                tooltip.style("visibility","visible")
                                                       .transition()
                                                       .duration(200)
                                                       .style("opacity", 1);
                                                tooltip.html("<span>" + d.key + "</span>" + station_rides(d, selected_month).toLocaleString('en') + " rides in " + monthNames[selected_month-1])
                                                       .style("left", (d3.event.pageX) + 10 + "px")
                                                       .style("top", (d3.event.pageY) + "px");

                                              })
                   .on('mouseout',function() {
                                                d3.select(this)
                                                  .transition()
                                                  .duration(100)
                                                  .attr('stroke-width',0);
                                                tooltip.transition()
                                                       .duration(500)
                                                       .style("opacity", 0)
                                              });
        }

        /** Create and display the legend **/
        function draw_legend() {

          var svg = d3.select('#map-legend')
                      .append('svg')
                      .attr('width', legend_width)
                      .attr('height', legend_height);

          //Draw the rectangle and fill with gradient
          legend = svg.append("g").classed('map-legend-layer', true);
          var defs = svg.append("defs");
          var linear_gradient = defs.append("linearGradient")
                                   .attr("id", "linear-gradient")

          linear_gradient.selectAll("stop")
                       .data(color_scale.range())
                       .enter().append("stop")
                       .attr("offset", function(d,i) { return i/(color_scale.range().length-1); })
                       .attr("stop-color", function(d) { return d; });

          legend.append('rect')
                .attr("width", legend_width)
                .attr("height", 10)
                .attr("x", 0)
                .attr("y", 0)
                .attr("rx", 5)
                .attr("ry", 5)
                .style("fill", "url(#linear-gradient)");

          legend.append('text')
                .attr("class", "lg_txt")
                .attr("y", 25)
                .attr("x", legend_width / 2)
                .style("text-anchor", "middle")
                .text('# of Monthly Rides');

          legend.append('text')
                .attr("class", "lg_txt")
                .attr("y", 25)
                .attr("x", 0)
                .style("text-anchor", "start")
                .text(0);

          legend.append('text')
                .attr("class", "lg_txt")
                .attr("y", 25)
                .attr("x", legend_width)
                .style("text-anchor", "end")
                .text(max_rides.toLocaleString());

        }



        /** Update callback to refresh the display of station ride counts **/
        function update_points(month_id) {
          plotLayer.selectAll('circle')
                   .data(station_data)
                   .attr("cx", function (d) { return projection(station_coord(d))[0]; })
                   .attr("cy", function (d) { return projection(station_coord(d))[1]; })
                   .attr("r", function (d) { return scale(station_rides(d, month_id)); })
                   .transition()
                   .duration(300)
                   .style("fill", function (d) { return color_scale(station_rides(d, month_id)); })
                   .style("fill-opacity", pt_opacity)
                   .style("visibility", function (d) { return station_rides(d, month_id) == 0 ? "hidden" : "visible"; })
                   .attr('stroke',colors.white)
                   .attr('stroke-width',0)
                   .style("cursor", "pointer");
        }

        create_points();
        draw_legend();
        return update_points;

      }

      function draw_annotations() {
        g = d3.select('#map-container').select('svg').select('g').append('g').classed('anot-layer', true);
        callback = buildAnnotation(d3.select('#map-container'), g, mapAnnotations);
        return callback;
      }

      // Initialize the visualization
      point_updater = draw_map();
      anot_updater = draw_annotations();

      draw_barchart(point_updater, anot_updater);

     }

    /** ------------- TIME OF DAY DATA VIZ ------------- **/
    function create_grid_viz(data) {

      const legend_height = 35;
      const legend_width = 250;

      const canvas_width = 800;
      const margin_left = 30;
      const margin_top = 50;
      const annotations_height = 150;
      const daychart_width = 50;
      const hourchart_height = 75;
      const heatmap_width = canvas_width - margin_left - daychart_width;
      const annotations_width = heatmap_width + daychart_width;
      const tilesize = Math.floor(heatmap_width / 24);
      const heatmap_height = 7 * tilesize;
      const hourchart_width = heatmap_width;
      const daychart_height = heatmap_height;
      const canvas_height = heatmap_height + margin_top + hourchart_height+annotations_height;

      var selected_month = 1;

      const max_rides = d3.max(data, function(d) { return d.ride_count; });

      // Group data by day of week and month
      const daily_data = d3.nest()
                          .key(function(d) { return +d.day_of_week; })
                          .sortKeys((a, b) => d3.ascending(+a, +b))
                          .key(function(d) { return +d.ride_month; })
                          .sortKeys((a, b) => d3.ascending(+a, +b))
                          .rollup(function(x) { return d3.sum(x, function(d) {return (d.ride_count)}); })
                          .entries(data);

      // Group data by hour and month
      const hourly_data = d3.nest()
                          .key(function(d) { return +d.hour_of_day; })
                          .sortKeys((a, b) => d3.ascending(+a, +b))
                          .key(function(d) { return +d.ride_month; })
                          .sortKeys((a, b) => d3.ascending(+a, +b))
                          .rollup(function(x) { return d3.sum(x, function(d) {return (d.ride_count)}); })
                          .entries(data);

      // Group data by month
      const monthly_max_data = d3.nest()
                                 .key(function(d) { return +d.ride_month; })
                                 .sortKeys((a, b) => d3.ascending(+a, +b))
                                 .rollup(function(x) { return d3.max(x, function(d) {return (+d.ride_count)}); })
                                 .entries(data);

      const max_rides_per_hour = maxRidesPerPeriod(hourly_data);
      const max_rides_per_dow = maxRidesPerPeriod(daily_data);


      // Create a gradient scale based on # of rides
      var color_scale = d3.scaleLinear()
                    .domain([0, 0.2, 0.4, 0.5, 0.7, 1])
                    .range([colors.light_blue, colors.cyan, colors.dark_purple, colors.purple, colors.yellow, colors.pink]);

      var svg = d3.select('#gridviz')
                  .append('svg')
                  .attr('width', canvas_width)
                  .attr('height', canvas_height);

      // Create groups for each of the three charts (heatmap, hour histogram, & day historgram)
      var heatmap = svg.append('g').classed('heatmap', true)
                       .attr("transform", "translate(" + margin_left + "," + margin_top + ")");
      var hour_chart = svg.append('g').classed('hour-chart', true)
                          .attr("transform", "translate(" + margin_left + "," + (margin_top + heatmap_height) + ")");
      var day_chart = svg.append('g').classed('day-chart', true)
                       .attr("transform", "translate(" + (margin_left + heatmap_width) + "," + margin_top + ")");
      var day_axis = svg.append('g').classed('day-axis', true)
                        .attr("transform", "translate(0,"+margin_top+")");
      var hour_axis = svg.append('g').classed('hour-axis', true)
                         .attr("transform", "translate(" + margin_left + ", 0)");


      var tooltip = d3.select("#tooltip")

      var prev_btn = d3.select("#gridviz-container").select(".prev")
      var next_btn = d3.select("#gridviz-container").select(".next")


      var format = d3.format(",d");

      /** Draw the hour/week day grid **/
      function draw_grid() {

        // Create the heatmap
        heatmap.selectAll('rect')
               .data(data.filter(function(d) { return +d.ride_month == selected_month; }))
               .enter()
               .append('rect')
               .attr("x", function(d) { return (+d.hour_of_day) * tilesize;})
               .attr("y", function(d) { return (+d.day_of_week - 1) * tilesize;})
               .attr("class", "grid-tile")
               .attr("width", tilesize)
               .attr("height", tilesize)
               .style("fill", function (d) { return color_scale(d.ride_count / getMaxHourlyRides(selected_month)); })
               .on('mouseover',function(d) {
                                            d3.select(this)
                                              .transition()
                                              .duration(100)
                                              .attr('stroke-width',2);
                                            tooltip.style("visibility","visible")
                                                   .transition()
                                                   .duration(200)
                                                   .style("opacity", 1);
                                            tooltip.html("<span>" + dayNames[d.day_of_week].short + " @ " +formatHour(d.hour_of_day) + "</span>" + Number(d.ride_count).toLocaleString('en') + " rides per hour")
                                                   .style("left", (d3.event.pageX) + 10 + "px")
                                                   .style("top", (d3.event.pageY) + "px");
                                          })
               .on('mouseout',function() {
                                            d3.select(this)
                                              .transition()
                                              .duration(100)
                                              .attr('stroke-width',0);
                                            tooltip.transition()
                                                   .duration(500)
                                                   .style("opacity", 0)
                                                   .transition()
                                                   .style("visibility","hidden");
                                          });


      }

      /** Draw day and hour labels on the heatmap **/
      function draw_labels() {

        // Draw hour axis
        hour_axis.selectAll('.xlabel')
                 .data(hourLabel)
                 .enter()
                 .append('text')
                 .attr('x', function(d,i) { return i*tilesize + 0.5*tilesize; })
                 .attr('y', margin_top-20)
                 .classed('xlabel', true)
                 .text(function(d,i) { return (i % 12 == 0) ? 12 : i % 12; });

      hour_axis.selectAll('.am-pm')
               .data(hourLabel)
               .enter()
               .append('text')
               .attr('x', function(d,i) { return i*tilesize + 0.5*tilesize; })
               .attr('y', margin_top - 5)
               .classed('am-pm', true)
               .text(function(d,i) { return (i < 12) ? "AM" : "PM"; });

      day_axis.selectAll('.ylabel')
               .data(dayLabel)
               .enter()
               .append('text')
               .attr('x', 0)
               .attr('y', function(d,i) { return i*tilesize + 0.5*tilesize+5; })
               .classed('ylabel', true)
               .text(function(d) { return d; });
      }

      /* Draw the distribution by hour bar chart */
      function draw_hour_chart() {
        hour_chart.selectAll('rect')
                  .data(hourly_data)
                  .enter()
                  .append('rect')
                  .attr('x', function(d,i) { return i*tilesize; })
                  .attr('width', tilesize)
                  .attr('height', function(d) { return getRidesForPeriod(d.values, selected_month) / max_rides_per_hour * hourchart_height; })
                  .classed('bar', true)
                  .on('mouseover',function(d) {
                                               d3.select(this)
                                                 .transition()
                                                 .duration(100)
                                                 .attr('stroke-width',2);
                                               tooltip.style("visibility","visible")
                                                      .transition()
                                                      .duration(200)
                                                      .style("opacity", 1);
                                               tooltip.html("<span>" + monthNames[selected_month-1] + " @ " +formatHour(+d.key) + "</span>" + Number(getRidesForPeriod(d.values, selected_month)).toLocaleString('en') + " rides")
                                                      .style("left", (d3.event.pageX) + 10 + "px")
                                                      .style("top", (d3.event.pageY) + "px");
                                             })
                  .on('mouseout',function() {
                                               d3.select(this)
                                                 .transition()
                                                 .duration(100)
                                                 .attr('stroke-width',0);
                                               tooltip.transition()
                                                      .duration(500)
                                                      .style("opacity", 0)
                                                      .transition()
                                                      .style("visibility","hidden");
                                             });
      }

      /* Draw the distribution by hour bar chart */
      function draw_day_chart() {
        day_chart.selectAll('rect')
                  .data(daily_data)
                  .enter()
                  .append('rect')
                  .attr('y', function(d,i) { return i*tilesize; })
                  .attr('height', tilesize)
                  .attr('width', function(d) { return getRidesForPeriod(d.values, selected_month) / max_rides_per_dow * daychart_width; })
                  .classed('bar', true)
                  .on('mouseover',function(d) {
                                               d3.select(this)
                                                 .transition()
                                                 .duration(100)
                                                 .attr('stroke-width',2);
                                               tooltip.style("visibility","visible")
                                                      .transition()
                                                      .duration(200)
                                                      .style("opacity", 1);
                                               tooltip.html("<span>" + dayNames[+d.key].full + "s in " +monthNames[selected_month-1]+ "</span>" + Number(getRidesForPeriod(d.values, selected_month)).toLocaleString('en') + " rides")
                                                      .style("left", (d3.event.pageX) + 10 + "px")
                                                      .style("top", (d3.event.pageY) + "px");
                                             })
                  .on('mouseout',function() {
                                               d3.select(this)
                                                 .transition()
                                                 .duration(100)
                                                 .attr('stroke-width',0);
                                               tooltip.transition()
                                                      .duration(500)
                                                      .style("opacity", 0)
                                                      .transition()
                                                      .style("visibility","hidden");
                                             });
      }

      /** Create and display the legend **/
      function draw_legend() {

        var svg = d3.select('#grid-legend')
                    .append('svg')
                    .attr('width', legend_width)
                    .attr('height', legend_height);

        //Draw the rectangle and fill with gradient
        legend = svg.append("g").classed('grid-legend-layer', true);
        var defs = svg.append("defs");
        var linear_gradient = defs.append("linearGradient")
                                 .attr("id", "linear-gradient")

        linear_gradient.selectAll("stop")
                     .data(color_scale.range())
                     .enter().append("stop")
                     .attr("offset", function(d,i) { return i/(color_scale.range().length-1); })
                     .attr("stop-color", function(d) { return d; });

        legend.append('rect')
              .attr("width", legend_width)
              .attr("height", 10)
              .attr("x", 0)
              .attr("y", 0)
              .attr("rx", 5)
              .attr("ry", 5)
              .style("fill", "url(#linear-gradient)");

        legend.append('text')
              .attr("class", "lg_txt")
              .attr("y", 25)
              .attr("x", legend_width / 2)
              .style("text-anchor", "middle")
              .text('# of Rides');

        legend.append('text')
              .attr("class", "lg_txt")
              .attr("y", 25)
              .attr("x", 0)
              .style("text-anchor", "start")
              .text("0");

        legend.append('text')
              .classed("lg_txt", true)
              .classed("max-rides", true)
              .attr("y", 25)
              .attr("x", legend_width)
              .style("text-anchor", "end")
              .text((getMaxHourlyRides(selected_month)).toLocaleString());

      }

      function draw_annotations() {
        g = d3.select('#gridviz').select('svg').append('g').classed('anot-layer', true);
        callback = buildAnnotation(d3.select('#gridviz'), g, gridAnnotations);
        return callback;
      }

      // Callback to update grid based on the selected month
      function update(month_id, anot_callback) {

        // Update the heatmap
        heatmap.selectAll('rect')
               .data(data.filter(function(d) { return +d.ride_month == month_id; }))
               .attr("x", function(d) { return (+d.hour_of_day) * tilesize;})
               .attr("y", function(d) { return (+d.day_of_week - 1) * tilesize;})
               .attr("class", "grid-tile")
               .attr("width", tilesize)
               .attr("height", tilesize)
               .transition().duration(250)
               .style("fill", function (d) { return color_scale(d.ride_count / getMaxHourlyRides(selected_month)); });

        // Add the selected month to the commentary
        d3.select('#gridviz-currentmonth')
          .transition().duration(150)
          .style("opacity", 0)
          .transition().duration(150)
          .style("opacity", 1)
          .text(monthNames[month_id-1] + " 2017");

        // Update the hour distribution
        hour_chart.selectAll('rect')
                  .data(hourly_data)
                  .transition()
                  .duration(250)
                  .attr('height', function(d) { return getRidesForPeriod(d.values, selected_month) / max_rides_per_hour * hourchart_height; });

        // Update the hour distribution
        day_chart.selectAll('rect')
                  .data(daily_data)
                  .transition()
                  .duration(250)
                  .attr('width', function(d) { return getRidesForPeriod(d.values, selected_month) / max_rides_per_dow * daychart_width; });

        // Update annotations
        anot_callback(month_id);

        // Update legend max rides count
        legend.select('.max-rides')
              .transition()
              .duration(250)
              .on("start", function repeat() {
                d3.active(this)
                  .tween("text", function() {
                    var that = d3.select(this),
                    i = d3.interpolateNumber(that.text().replace(/,/g, ""), getMaxHourlyRides(month_id));
                    return function(t) { that.text(format(i(t))); };
                  });
        });


      }

      function onMonthClick(dir, anot_callback) {
        new_month = selected_month + dir;
        if (new_month <= 12 & new_month >= 1) {
          selected_month = new_month;
          next_btn.classed("disabled", selected_month == 12);
          prev_btn.classed("disabled", selected_month == 1);

          update(selected_month, anot_callback);
        }
      }

      /* HELPER FUNCTIONS */

      // Max monthly rides that occurred in a given time period (based on first level of nested data)
      function maxRidesPerPeriod(d) {
        m = 0;
        d.forEach( function(unit) {
          unit.values.forEach( function(month) {
            if (month.value > m) {
              m = month.value;
            }
          })
        });
        return m;
      }

      // For a data point, get the ride data for the specified month
      function getRidesForPeriod(d, month_id) {
        var r;
        d.forEach( function(m) {
          if (+m.key == month_id) {
            r=m.value;
          }
        });
        return r;
      }

      // Get the max rides in an hourly time period for the specified month
      function getMaxHourlyRides(month_id) {
        return getRidesForPeriod(monthly_max_data, month_id);
      }

      /* INITIALIZE THE HEATMAP VIZ */
      draw_grid();
      draw_labels();
      draw_hour_chart();
      draw_day_chart();
      draw_legend();
      anot_callback = draw_annotations();
      update(selected_month, anot_callback);

      // Register event handlers
      d3.select("#gridviz-container")
        .select(".next")
        .on("click", function() { onMonthClick(+1, anot_callback); });

        d3.select("#gridviz-container")
          .select(".prev")
          .on("click", function() { onMonthClick(-1, anot_callback); });

    }

    /** ANNOTATION BUILDER **/
    function buildAnnotation(parent, g, aArr) {
      const v_margin = 10;
      const h_margin = 10;

      function leaderPath(d) {
        x1 = d.left+d.width+h_margin;
        y1 = d.top+v_margin;
        x2 = d.end_x;
        y2 = d.end_y;

        return "M"+x1+","+y1+"L"+x2+","+y2;
      }

      function needsLeader(d) {
        return (d.end_x != undefined & d.end_y != undefined);
      }

      filtered_data = aArr.filter(function(d) { return needsLeader(d); });

      // Create the annotation container
      aDivs = parent.selectAll('.annotation')
                    .data(aArr)
                    .enter()
                    .append('div')
                    .classed('annotation', true)
                    .classed('hidden', true)
                    .style('top', function(d) { return d.top + "px"; })
                    .style('left', function(d) { return d.left + "px"; })
                    .style('width', function(d) { return d.width + "px"; })

      // Add the annotation titles and bodies
      aDivs.append('span').classed('title', true).text(function(d){ return d.title; });
      aDivs.append('span').classed('body', true).text(function(d){ return d.body; });



      g.selectAll('.leader-line')
                  .data(filtered_data)
                  .enter()
                  .append('path')
                  .attr("d",function(d) { return leaderPath(d); })
                  .classed('leader-line', true)
                  .classed('hidden', true);


      /** Update callback **/
      var update = function(month_id) {
        filtered_data = aArr.filter(function(d) { return needsLeader(d); });
        parent.selectAll('.annotation')
              .data(aArr)
              .classed('hidden', function(d) { return d.month != month_id; })
              .classed('visible', function(d) { return d.month == month_id; });

        g.selectAll('.leader-line').data(filtered_data)
                    .classed('hidden',  function(d) { return d.month != month_id; })
                    .classed('visible', function(d) { return d.month == month_id; });

      }

      return update;

    }

    /** ANNOTATIONS **/
    var mapAnnotations = [
      {
        "title": "Baby, it's cold outside!",
        "body": "January had the fewest rides of any month; less than 40% of peak monthly demand.",
        "top": 40,
        "left": 70,
        "width": 175,
        "month": 1
      },
      {
        "title": "One Hot Spot",
        "body": "Pershing Sq North was by far the busiest station in January.",
        "top": 180,
        "left": 20,
        "end_x": 325,
        "end_y": 190,
        "width": 175,
        "month": 1
      },
      {
        "title": "Spring has sprung",
        "body": "Rides nearly doubled from the previous month. Spring weather is likely a contributing factor.",
        "top": 40,
        "left": 70,
        "width": 175,
        "month": 4
      },
      {
        "title": "Heavy demand south of central park",
        "body": "While Citibike operates in all five boroughs, demand concentrates in Manhattan--mostly Midtown to Central Park.",
        "top": 160,
        "left": 20,
        "end_x": 250,
        "end_y": 210,
        "width": 175,
        "month": 4
      },
      {
        "title": "Subway proximity drives demand",
        "body": "West St & Chambers St. bikeshare station is near a busy subway stop.",
        "top": 160,
        "left": 0,
        "end_x": 245,
        "end_y": 296,
        "width": 225,
        "month": 5
      },
      {
        "title": "Summer leisure riders",
        "body": "Ridership continues to climb through the summer.",
        "top": 160,
        "left": 20,
        "end_x": 250,
        "end_y": 210,
        "width": 175,
        "month": 6
      },
      {
        "title": "New Manhattan stations",
        "body": "Citibike extended its network, adding more stations in the northern part of Manhattan.",
        "top": 10,
        "left": 100,
        "end_x": 380,
        "end_y": 20,
        "width": 175,
        "month": 9
      },
      {
        "title": "Expanding in Queens",
        "body": "Citibike also added more stations throughout Queens in September.",
        "top": 160,
        "left": 30,
        "end_x": 430,
        "end_y": 170,
        "width": 200,
        "month": 9
      },
      {
        "title": "Even more expansion",
        "body": "Continuing the trend from September, Citibike continues to add stations, expanding the reach in Queens.",
        "top": 120,
        "left": 30,
        "end_x": 450,
        "end_y": 130,
        "width": 200,
        "month": 10
      },
      {
        "title": "New Brooklyn stations",
        "body": "Citibike also added new stations in Brooklyn.",
        "top": 300,
        "left": 0,
        "end_x": 380,
        "end_y": 430,
        "width": 200,
        "month": 10
      },
      {
        "title": "Rides peak in October",
        "body": "Ridership reached its max during October in 2017. Nearly 1.9 million rides across the network.",
        "top": 0,
        "left": 100,
        "width": 200,
        "month": 10
      },
      {
        "title": "Ridership cools with the weather",
        "body": "The number of rides drops sharply due in part to colder temparatures.",
        "top": 40,
        "left": 70,
        "width": 225,
        "month": 11
      }
    ];

    var gridAnnotations = [
      {
        "title": "Morning Commute",
        "body": "Even when it's cold, commuters utilize the Citibike system during weekdays.",
        "top": 350,
        "left": 50,
        "end_x": 240+30+15,
        "end_y": 90+50+15,
        "width": 200,
        "month": 1
      },
      {
        "title": "Evening Commute",
        "body": "The 5-7PM evening commute also creates a spike in demand.",
        "top": 350,
        "left": 300,
        "end_x": 240+30+15+285,
        "end_y": 90+50+15,
        "width": 200,
        "month": 1
      },
      {
        "title": "Morning Commute",
        "body": "21% of rides occur between 7AM & 10AM.",
        "top": 350,
        "left": 240+30-150,
        "end_x": 240+30+15,
        "end_y": 300,
        "width": 150,
        "month": 2
      },
      {
        "title": "Evening Commute",
        "body": "26% of rides occur between 4PM & 7PM.",
        "top": 350,
        "left": 510+30-150,
        "end_x": 510+15+30,
        "end_y": 300,
        "width": 150,
        "month": 2
      },
      {
        "title": "Morning Commute",
        "body": "21% of rides occur between 7AM & 10AM.",
        "top": 350,
        "left": 240+30-150,
        "end_x": 240+30+15,
        "end_y": 300,
        "width": 150,
        "month": 3
      },
      {
        "title": "Evening Commute",
        "body": "28% of rides occur between 4PM & 7PM.",
        "top": 350,
        "left": 510+30-150,
        "end_x": 510+15+30,
        "end_y": 300,
        "width": 150,
        "month": 3
      },
      {
        "title": "Relaxing weekend rides",
        "body": "To shake cabin fever, people head out for a leisurely weekend afternoon ride.",
        "top": 350,
        "left": 150,
        "end_x": 450,
        "end_y": 245,
        "width": 200,
        "month": 4
      },
      {
        "title": "Relaxing weekend rides",
        "body": "To shake cabin fever, people head out for a leisurely weekend afternoon ride.",
        "top": 350,
        "left": 150,
        "end_x": 450,
        "end_y": 65,
        "width": 200,
        "month": 4
      },
      {
        "title": "Morning Commute",
        "body": "19% of rides occur between 7AM & 10AM.",
        "top": 350,
        "left": 240+30-150,
        "end_x": 240+30+15,
        "end_y": 300,
        "width": 150,
        "month": 5
      },
      {
        "title": "Evening Commute",
        "body": "27% of rides occur between 4PM & 7PM.",
        "top": 350,
        "left": 510+30-150,
        "end_x": 510+15+30,
        "end_y": 300,
        "width": 150,
        "month": 5
      },
      {
        "title": "Morning Commute",
        "body": "18% of rides occur between 7AM & 10AM.",
        "top": 350,
        "left": 240+30-150,
        "end_x": 240+30+15,
        "end_y": 300,
        "width": 150,
        "month": 6
      },
      {
        "title": "Evening Commute",
        "body": "26% of rides occur between 4PM & 7PM.",
        "top": 350,
        "left": 510+30-150,
        "end_x": 510+15+30,
        "end_y": 300,
        "width": 150,
        "month": 6
      },
      {
        "title": "Morning Commute",
        "body": "16% of rides occur between 7AM & 10AM.",
        "top": 350,
        "left": 240+30-150,
        "end_x": 240+30+15,
        "end_y": 300,
        "width": 150,
        "month": 7
      },
      {
        "title": "Evening Commute",
        "body": "27% of rides occur between 4PM & 7PM.",
        "top": 350,
        "left": 510+30-150,
        "end_x": 510+15+30,
        "end_y": 300,
        "width": 150,
        "month": 7
      },
      {
        "title": "Morning Commute",
        "body": "18% of rides occur between 7AM & 10AM.",
        "top": 350,
        "left": 240+30-150,
        "end_x": 240+30+15,
        "end_y": 300,
        "width": 150,
        "month": 8
      },
      {
        "title": "Busiest Hour of the Year",
        "body": "Riders took 35,360 rides on Wednesday between 6 & 7PM.",
        "top": 380,
        "left": 510+30-200,
        "end_x": 540+15+30,
        "end_y": 90+50+15,
        "width": 200,
        "month": 8
      },
      {
        "title": "Morning Commute",
        "body": "18% of rides occur between 7AM & 10AM.",
        "top": 380,
        "left": 240+30-150,
        "end_x": 240+30+15,
        "end_y": 300,
        "width": 150,
        "month": 9
      },
      {
        "title": "Evening Commute",
        "body": "27% of rides occur between 4PM & 7PM.",
        "top": 380,
        "left": 510+30-150,
        "end_x": 510+15+30,
        "end_y": 300,
        "width": 150,
        "month": 9
      },
      {
        "title": "Morning Commute",
        "body": "19% of rides occur between 7AM & 10AM.",
        "top": 380,
        "left": 240+30-150,
        "end_x": 240+30+15,
        "end_y": 300,
        "width": 150,
        "month": 10
      },
      {
        "title": "Evening Commute",
        "body": "27% of rides occur between 4PM & 7PM.",
        "top": 380,
        "left": 510+30-150,
        "end_x": 510+15+30,
        "end_y": 300,
        "width": 150,
        "month": 10
      },
      {
        "title": "Morning Commute",
        "body": "21% of rides occur between 7AM & 10AM.",
        "top": 350,
        "left": 240+30-150,
        "end_x": 240+30+15,
        "end_y": 300,
        "width": 150,
        "month": 11
      },
      {
        "title": "Evening Commute",
        "body": "25% of rides occur between 4PM & 7PM.",
        "top": 350,
        "left": 510+30-150,
        "end_x": 510+15+30,
        "end_y": 300,
        "width": 150,
        "month": 11
      },
      {
        "title": "Morning Commute",
        "body": "22% of rides occur between 7AM & 10AM.",
        "top": 350,
        "left": 240+30-150,
        "end_x": 240+30+15,
        "end_y": 300,
        "width": 150,
        "month": 12
      },
      {
        "title": "Evening Commute",
        "body": "24% of rides occur between 4PM & 7PM.",
        "top": 350,
        "left": 510+30-150,
        "end_x": 510+15+30,
        "end_y": 300,
        "width": 150,
        "month": 12
      }
    ];

  </script>
</body>
</html>
